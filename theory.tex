\chapter{Modeling laser atom interactions}
\label{cha:numberic_methods}
In order to study laser atom interactions on the attosecond time scale, I have developed or implemented a variety of numerical and analytic tools. In Sec.~\ref{sec:TDSE} I introduce the Time-dependent Schr\"odinger equation (TDSE), Sec.~\ref{sec:perturbation_theory} I introduce the perturbative solution to the TDSE, Sec.~\ref{sec:numerical_methods} gives the details for how I solve the TDSE numerally, Sec.~\ref{sec:SAE} discusses the various single active electron (SAE) potentials used to model atoms other than Hydrogen, Sec.~\ref{sec:two_active_electron_time_calculations} provides an introduction to calculations involving two active electrons, Sec.~\ref{sec:laser_pulses} provides details on the laser pulses utilized in the calculations including a frequency correction I helped develop, and Sec.~\ref{sec:observables} provides details on how the various observables are calculated.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Time-dependent Schr\"odinger equation}
\label{sec:TDSE}
The TDSE can be written simply as
\begin{equation}
    i\frac{\partial}{\partial t}\psi(\mathbf{r},t) = \hat{H}\psi(\mathbf{r},t)
    \label{eq:TDSE}
\end{equation}
where $i$ is the imaginary number, $\hat{H}$ is the Hamiltonian which describes the system, and $\psi(\mathbf{r},t)$ is the time dependent wavefunction. The Hamiltonian for a $N_e$ correlated electron system interacting with a laser and $N_n$ fixed nuclei is
\begin{equation}
    \label{eq:atoms_and_molecules}
    \hat{H} = \sum_{e}^{N_e}\left(\frac{\hat{\mathbf{p}}^2_e}{2} + V_{las}(\mathbf{r},t) - \sum_{n}^{N_n} \frac{Z_n}{r_{e,n}}\right) + \sum_{e_1 < e_2}^{N_e}\frac{1}{r_{e_1, e_2}}
\end{equation}
where $\hat{\mathbf{p}_e}=(-i\nabla_e)$ is the momentum operator of the $e^{th}$ electron, $V_{las}(\mathbf{r},t)$ is the laser operator, $Z_n$ is the charge of the $n^{th}$ nuclei, and $r_{i,j}$ is the distance between particles $i$ and $j$. The laser interaction is typically done considering both the dipole and non-relativistic approximations in either the length gauge ($V_{las} = - \mathbf{E}(t)\cdot \mathbf{x}$) or velocity gauge ($V_{las} = - \mathbf{A}(t)\cdot \hat{\mathbf{p}}_e / c$). Solving this Hamiltonian accurately in full dimensions for more than 1 electron is extremely difficult and next to impossible for 3 or more active electrons. For most studies, we make the single active electron approximation (SAE) where a potential is used to model the fixed electrons and nuclei. The SAE Hamiltonian of an atom becomes 
\begin{equation}
    \label{eq:SAE}
    \hat{H} = \frac{\hat{\mathbf{p}}^2}{2} + V_{las}(\mathbf{r},t) + V_{SAE}(r)
\end{equation}
where $V_{SAE}(r)$ is the SAE potential. For details on two-active electron calculation see Sec.~\ref{sec:two_active_electron_time_calculations} and Chapter~\ref{cha:electron_correlation}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Perturbation theory} % (fold)
\label{sec:perturbation_theory}
In the case of a weak laser (typically intensities $<10^{13}$ W/cm$^2$) relative to the atomic potential the TDSE can be solved in a perturbative way. In some cases, such as the hydrogen atom, perturbation theory (PT) can be done analytically. However, many of the SAE potentials we use do not have analytic solutions. In such a case, a numerical solution to PT provides much of the same insight for a more general potential. Therefore, I will build the framework for numerical solutions. We start by diagonalizing our field free Hamiltonian $H_0$ to discretized both the bound (Sec.~\ref{sub:bound_state_calculations}) and continuum states (Sec.~\ref{sub:continuum_states}). The result will be our Green's function 
\begin{equation}
\label{eq:pt_green_func}
    G_0(t,t') = \SumInt_g e^{-iE_g t}\ket{\phi_g(t)}\bra{\phi_g(t')} e^{iE_g t'}
\end{equation}
where $\bra{\phi_g(t')}$ is the field free states (both bound and continuum), $E_g$ is the energy of the state, and $t$ is time. From some initial wavefunction $\ket{\Psi_0(\mathbf{r},t)}$, the next order PT can be obtained via
\begin{equation}
    \ket{\Psi_{i+1}(\mathbf{r},t)} = \int_{-\infty}^t dt_1 G_0(t,t_1)V_{las}(t_1)\ket{\Psi_i(\mathbf{r},t_1)}.
\end{equation}
The total wavefuction can then be obtained by summing over all $N$ orders of PT such that 
\begin{equation}
    \ket{\Psi(\mathbf{r},t)}^{(N)} = \sum_i^N \ket{\Psi_{i}(\mathbf{r},t)}
\end{equation}
The wavefunction can then be used to extract observables (Sec.~\ref{sec:observables}) in the same way you would for a numerical solution to the TDSE. Additionally, you can look at the wavefunction of a particular order to extract further information about how many photons are involved in a process. 

\subsection{Selection rules} % (fold)
\label{sub:selection_rules}
It is often most convenient to utilize spherical harmonics to expand the wavefunction. This allows for selection rules to be applied. Here the selection rules for length gauge ($V_{las}=-\mathbf{E}\cdot \mathbf{r}$) will be given, though the velocity gauge is similar. The $z$-axis is the simplest, so we begin with 
\begin{equation}
    V_{las}=-E_zz
\end{equation}
Noting that $z=r\cos(\theta)$ we get 
\begin{align}
    V_{las}&=-E_zr\cos(\theta)\\
    &=-2E_zr\sqrt{\frac{\pi}{3}}Y_1^0(\theta,\phi)
\end{align}
where $Y_\ell^m(\theta,\phi)$ is a spherical harmonic. The laser term can then be used to calculate the angular portion of the matrix elements 
\begin{equation}
    \bra{Y_{\ell'}^{m'}}V_{las}\ket{Y_{\ell}^{m}} = -2E_zr\sqrt{\frac{\pi}{3}}\bra{Y_{\ell'}^{m'}}Y_1^0\ket{Y_{\ell'}^{m'}}
\end{equation}
The integral of 3 spherical harmonics can be written as 
\begin{equation}
    \int_{4\pi} Y_{\ell_1}^{m_1*}Y_{\ell_2}^{m_2*}Y_{L}^{M} = \sqrt{\frac{(2\ell_1+1)(2\ell_2+1)}{4\pi(2L+1)}}\bra{\ell_1,0,\ell_2,0}\ket{L,0}\bra{\ell_1,m_1,\ell_2,m_2}\ket{L,M}
\end{equation}
where $\bra{\ell_1,m_1,\ell_2,m_2}\ket{L,M}$ is a Clebsch–Gordan coefficient, gives
\begin{align}
    \bra{Y_{\ell'}^{m'}}V_{las}\ket{Y_{\ell}^{m}} &= -E_zr\sqrt{\frac{(2\ell_1+1)(2\ell_2+1)}{3(2L+1)}}\bra{\ell',0,1,0}\ket{\ell,0}\bra{\ell',m',1,0}\ket{\ell,m}
\end{align}
which is only non zero given $\ell' = \ell \pm 1$ and $m'=m$. Therefore, the selection rules for a linearly polarized laser in the z-axis of $\Delta\ell=\pm1$ and $\Delta m = 0$. A similar process can be followed for a linearly polarized laser in either the $\hat{x}$ or $\hat{y}$ axis giving $\Delta\ell=\pm1$ and $\Delta m = \pm1$. Finally, a circularly polarized laser in the xy-plane give $\Delta\ell=\pm1$ and $\Delta m = 1$ for absorbing a right handed photon and $\Delta\ell=\pm1$ and $\Delta m = -1$ for absorbing a left handed photon. By taking advantage of selection rules, one can greatly reduce the size of a wavefunction used in a particular order of PT.
% subsection selection_rules (end)

% section perturbation_theory (end)

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Numerical Methods} % (fold)
\label{sec:numerical_methods}
For much of the parameter regime we are interested in, perturbation theory fails to provide a converged solution. Therefore, we solve the TDSE numerically. As with most partial differential equations, numerical solutions to the TDSE have a relatively simple overview. First, one chooses a basis/discretization to write down the solution (wavefunction). Next, the operators are expanded in the basis and stored in a matrix. Then, one obtains a set of initial conditions at the start of the simulation, in this case a bound state of the atom or molecule. Finally, the initial condition is propagated in time with updates to the operating matrix between time steps. In this section, I will layout the basis/discretization choices in Sec.~\ref{sub:coordinate_systems}, followed by a detailed discussion of the implementation in the remaining subsections. For the sake of simplicity, I will focus on single active {}electron calculations in this section. For details on two-active electron calculation see Sec.~\ref{sec:two_active_electron_time_calculations} and Chapter~\ref{cha:electron_correlation}.



\subsection{Coordinate systems} % (fold)
\label{sub:coordinate_systems}
The solution to a single active election calculation is three dimensional. The simplest and most general basis would be expand the wavefunction as a 3D grid in real space with the atom or molecule placed in the center. Such a grid is produced by discretizing each dimension (1D problem) and then taking a Kronecker product producing a 1D vector that represents the full 3D Cartesian space. The derivative operators can then be discretized utilizing finite differences (discussed in the next section) and stored in a matrix. The implementation is relatively straight forward and there are no assumptions about the symmetry of the problem. However, for larger atoms and high intensity laser pulse, the number of points in each direction ($N$) increases. The resulting calculation scales like $N^3$ leading to difficulties in obtaining converged results in a reasonable amount of time. It is, therefore, useful to look at the symmetries of the problem in question to greatly speed up the calculations. Two standard approaches are utilizing cylindrical or spherical coordinates. 

The problem of atom or linear molecule aligned with a linearly polarized laser is cylindrically symmetric. Therefore the choice of cylindrical coordinates is natural. By placing the laser polarization (and internuclear axis) along the z-axis, the behavior in the angular coordinate ($\phi$) is fixed by the initial condition and is handled analytically. Therefore, one only needs to treat the $z$ and $\rho$ dimensions numerically reducing the problem to two dimensions. As a result, solutions scale like $N^2$ greatly accelerating calculations when compared to a 3D Cartesian. 

However, we have found spherical codes to be the fastest. When written in spherical coordinates, the TDSE for a central potential (such as an atom) can be separated into a radial equation the contains the potential, and a angular portion that is independent of the potential. The angular portion has an analytical solution in the form of spherical harmonics leaving only the radial portion to be solve. For the hydrogen atom the solution is analytic, but it is not for a general potential. Therefore, I expand the wavefunction in spherical harmonics and then use finite difference to discretized the radius. Since the laser only couple spherical harmonics $\ell \rightarrow \ell +1$ and $m \rightarrow m,m\pm1$ depending on the polarization, the number of spherical harmonics needed is small (typically $\ell_{max}<50$) with a weak dependence on laser intensity and wavelength. The result is a code that scales like $N\ell$ for linear polarization and $N\ell^2$ for arbitrary polarization. Since $\ell$ is small, the code typically scales like $N$ as the pulse intensity or wavelength is changed.
% subsection coordinate_systems (end)

\subsection{Finite difference} % (fold)
\label{sub:finite_difference}
To discretized the spacial derivatives, I use finite difference. When using finite differences, derivatives are represented by a set of coefficients called a stencil. The stencil provides the non-zero $c_i$ weights for various sample points of the function. You can then write the second derivative of $\psi$ known at various evenly spaced grid points labeled by $n$ as
\begin{equation}
    \frac{d^2}{dx^2}\psi_n = \frac{1}{\Delta x^2}\sum_i c_i \psi_i
    \label{eq:finite_diff}
\end{equation}
The non zero $c_i$ coefficients are given in the table below for various orders of accuracy.
\begin{center}
\begin{tabular}{ |c|c|c|c|c|c|c|c| }
\hline
Order & $c_{n-3}$ & $c_{n-2}$ & $c_{n-1}$ & $c_{n}$ & $c_{n+1}$ & $c_{n+2}$ & $c_{n+3}$ \\ \hline
2nd   &      &      & -1   & 2  & -1   &      &      \\ \hline
4th   &      & $-1/12$ & $4/3$   & $-5/2$  & $4/3$   &  $-1/12$    &      \\ \hline
6th   &   $1/90$   &  $-3/20$    & $3/2$   & $-49/18$  & $3/2$   &   $-3/20$    &   $1/90$  \\ \hline
\end{tabular}
\end{center}

Although it is possible to hard code the stencil weights, it becomes quite tedious particularly for high order stencils, non-uniform grids, and near boundaries where off-centered stencils are needed. Therefore I utilize the Fornberg method \cite{Fornberg1988} to obtain the necessary stencil for a particular simulation. 

For the remainder of this discussion, we will assume we are using second order derivatives. However, this will be expendable to higher order derivatives by adding more off diagonal elements in matrices discussed in this section. 

For the start of this discussion, we will consider a 1D wavefunction. We will later extend this to ND wavefunctions. We start with $\psi(x)$ known at various points along the $x$ axis spaced by a grid step of $dx$. We will label the points by $n$ such that $\psi_n = \psi(x_0 + dx*n)$ with $x_0$ being the lowest $x$ value. Plugging this into Equation~\ref{eq:finite_diff} we get
\begin{equation}
    \frac{d^2}{dx^2}\psi_n = \frac{1}{\Delta x^2}\left(-\psi_{n-1}+2\psi_n-\psi_{n+1} \right)
    \label{eq:finite_diff_second_order}
\end{equation}
Now we can write this for the point $\psi_{n+1}$ giving us
\begin{equation}
    \frac{d^2}{dx^2}\psi_{n+1} = \frac{1}{\Delta x^2}\left(-\psi_{n}+2\psi_{n+1}-\psi_{n+2} \right)
    \label{eq:finite_diff_second_order_n+1}
\end{equation}
This can be done until we hit the other end of the grid. If we take the boundary condition that $\psi(x_0-dx)=\psi(x_N+dx)=0$, we can write our operator as a system of linear equations in the form of a matrix. Our matrix becomes
\begin{equation}
\frac{d^2\psi}{dx^2} =
\frac{1}{\Delta x^2}
\begin{bmatrix}
    2 & -1 &  &  &   &  \\
    -1 & 2 & -1 &  &  &  \\
     & \ddots & \ddots & \ddots & \\
     &  & -1 & 2 & -1\\
     &   &  & -1 & 2
\end{bmatrix}
\begin{bmatrix}
    \psi_{0} \\
    \psi_{1} \\
    \vdots  \\
    \psi_{N-1}  \\
    \psi_{N}
\end{bmatrix}
\end{equation}
One then uses a tensor product to produce the 2 and 3 dimensional versions of an operator.
% subsection finite_difference (end)

\subsection{Radial basis functions} % (fold)
\label{sub:radial_basis_functions}
\textbf{TODO}
% subsection radial_basis_functions (end)

\subsection{Numerical integration} % (fold)
\label{sub:numerical_integration}
For the finite difference integration, either the midpoint or trapezoid rule are used for numerical integration. For both methods the integration is preformed by 
\begin{equation}
    \int_{x} f(x')dx' = \sum_i^n c_i f(x_i)
\end{equation}
where $f(x_i)$ is the value of the function at $x_i$ and $x$ is the integration interval. The midpoint rule is used if the grid is placed at half grid points on the interval (i.e. $x_i = (2i+1)dx/3$ for $i=0,1,2,...,n$). In this case $c_i = 1/dx$ for all grid points. For the trapezoid rule the grid points sample the ends of the integration range resulting in $c_0 = c_n = 1/2dx$ and $c_i = 1/dx \in i=1...n-1$. 

In the case of the RBF code, the MD node set comes with a provided integration weight for the angular integration and the radial integration is done via the midpoint rule. 
For the spherical code, the angular integration is done analytically as spherical harmonics are orthonormal.
% subsection numerical_integration (end)

\subsection{Boundary conditions} % (fold)
\label{sub:boundary_conditions}
The wavefunction at large $r$ must decay to zero for it to be normalizable. Therefore we set the wavefunction to zero at $r_{max}$ and increase the value of $r_{max}$ until a converged result is obtained (Sec.~\ref{sub:convergence_studies}). The exterior complex scaling (Sec~\ref{sub:exterior_complex_scaling}) insures the wavefunction decays prior to hitting the boundary. For the Cartesian code, this is the only boundary condition needed. For the cylindrical and spherical codes, the boundary condition at $r=0$ is required. The cylindrical code the grid is chosen such that the grid points are $x_i = (2*i+1)dx/2 \in i=0,1,2...$ and the boundary condition of $\psi(-x)=\psi(x)$ is used. In the spherical code, however, $x_i = idx \in i=1,2,3...$ and the boundary condition of $\psi(0)=0$ is used. To enforce a boundary condition a ``ghost node'' is implemented. The ghost node is a grid point that falls outside of the grid. If the ghost node is set to zero, the coefficient is left off the matrix, and the boundary condition is met. If the stencil would be hanging off by more than one point, such as in 4th order finite difference, the stencil is shifted so that only one point hangs off the grid and it retains the same width. For the cylindrical case, the ghost node is taken at $\psi(-dx/2)$. Since $\psi(-x)=\psi(x)$, the stencil coefficient at $\psi(-dx/2)$ is added to the coefficient for $\psi(dx/2)$ which imposes the boundary condition.

\textbf{TODO: Produce a graphic to depict a ghost node and show how offset FD is implemented.}
% subsection boundary_conditions (end)

\subsection{Exterior complex scaling} % (fold)
\label{sub:exterior_complex_scaling}
To absorb any outgoing wave packets, we utilize an exterior complex scaling (ECS). This is equivalent to changing the spacial step used in finite difference from $x_{n+1} = x_n+dx$ to $x_{n+1} = x_n+e^{i\eta}dx$. Taking $\eta=\pi / 4.0$ works well. This leads to an exponential decay of the wavefunction in the absorbing region. Obtaining the finite difference weights in the transition and ECS region is done implementing the Fornberg method \cite{Fornberg1988} using complex numbers.
% subsection exterior_complex_scaling (end)


\subsection{Bound state calculations} % (fold)
\label{sub:bound_state_calculations}
The bound states of the system are simply the eigenstates of the Hamiltonian with energies less than zero. Therefore they satisfy the equation 
\begin{equation}
    \hat{H} \phi_i = E_i \phi_i
\end{equation}
where $\hat{H}$ is the Hamiltonian, $E_i$ is the energy, and $\phi_i$ is the bound state assuming $E_i$ is less than zero. To solve for the bound states, we use the Krylov-Schur method that is implemented in the SLEPc library \textbf{CITATION NEEDED}. When obtained using SLEPc, the states have a random complex phase associated with them. The phase is physically irreverent unless one is creating a superposition or comparing the phase of populations between calculations that uses different bound state sets such as a TDSE and PT result. To avoid issues, it is best to use a single bound state calculation for each project.
% subsection bound_state_calculations (end)

\subsection{Continuum states} % (fold)
\label{sub:continuum_states}
The continuum has states at all energy levels greater than zero in the physical problem. However, when we solve the TDSE numerically, the continuum is represented via a discrete set of states. The grid that is chosen for the TDSE solution sets $\psi(0) = \psi(r_{max}) = 0$ (for a radial coordinate). The result is the same boundary condition as an infinite square well with a bottom in the shape of $V(r)$. The continuum states are therefore a distorted solution to infinite square well problem. We can obtain these states by the same method as used in the bound state calculations providing a discrete set of energies that represent the continuum. This method is used for the numerical PT solution found in Sec.~\ref{sec:perturbation_theory}.

When calculating a photoelectron spectrum, however, it is advantageous to be able to select the energy of the continuum wave. For this case, I utilize the shooting method to obtain a continuum wave at a given energy. The problem is an ODE and one solves it as follows. The wavefuction at $r=0$ is set to 0 by the boundary condition. The first point at $r_0=dr$ is set to an arbitrary value (in this case 1) giving 
\begin{equation}
    \phi_{kl}(r_0) = 1.
\end{equation}
with $k=\sqrt{2E}$. The second point is the obtained by
\begin{equation}
    \phi_{kl}(r_1) = \phi_{kl}(r_0) \left(dr^2\left[\frac{\ell (\ell+1)}{r^2} + 2V(r_0) -2 E\right]+2 \right). 
\end{equation}
Then every additional point is solved by 
\begin{equation}
    \phi_{kl}(r_{i+1}) = \phi_{kl}(r_i) \left(dr^2\left[\frac{\ell (\ell+1)}{r^2} + 2V(r_i) -2 E\right]+2 \right) - \phi_{kl}(r_{i-1}).
\end{equation}
Now that the wavefunction has been obtained, we match the asymptotic solution to that for the Hydrogen atom 
\begin{equation}
  \phi_{kl}(r\gg1) \rightarrow \sin\left[kr - \frac{l\pi}{2} +\frac{Z}{k} \ln(2kr) + \delta_{kl} \right].
\end{equation}
The continuum state is then normalized to oscillated between -1 and 1 at $r\gg1$ giving a normalization of
\begin{equation}
  A = \left[\frac{1}{\sqrt{|\phi_{kl}(r)|^2 + \left|\frac{\phi_{kl}'(r)}{(k+\frac{Z}{kr})}\right|^2}} \right]_{r=r_{max}}.
\end{equation}
Finally, we extract the phase shift $\delta_{kl}$ is obtained by
\begin{equation}
    \delta_{kl} = \left[Arg\left(\frac{i\phi_{kl}(r) + \frac{\phi_{kl}'(r)}{(k+\frac{Z}{kr})} }{(2kr)^{iZ/k}}\right) - kr + \frac{l\pi}{2} \right]_{r=r_{max}}.
\end{equation}
This continuum state can then be used to obtain the photoelectron spectrum by 
\begin{equation}
    P(k,\theta,\phi) \propto \left|\sum_{l,m} Y_{l,m}(\theta,\phi)\int  e^{-i\delta_{kl}}(i)^l \phi_{kl}(r)^* \psi(r,t) dr \right|^2.
\end{equation}
% subsection continuum_states (end)

\subsection{Time propagation} % (fold)
\label{sub:time_propagation}
Time propagation is often performed using the split-operator method where the Hamiltonian ($\hat{H}$) split into its spatial dimensions, e.g. along ($z$) and perpendicular ($\rho$) to the laser polarization direction. The resulting propagation scheme is
%
\begin{equation}
    \psi(\mathbf{r},t+\Delta t) \approx e^{-i\hat{H}_{\rho}\frac{\Delta t}{2}} e^{-i\hat{H}_z(t)\Delta t} e^{-i\hat{H}_{\rho}\frac{\Delta t}{2}}\psi(\mathbf{r},t).
     \label{eq:Split-operator}
\end{equation}
%
where
\begin{equation}
    e^{-i\hat{H}\Delta t} \approx \frac{1-i\frac{\Delta t}{2} \hat{H}}{1+i\frac{\Delta t}{2} \hat{H}}
\end{equation}
produces a set of tridiagonal matrices which can be solved with $\mathcal{O}(\mathcal{N})$ operations and $\mathcal{O}(\mathcal{N})$ memory. However, parallelization of such a method on a modern supercomputer with distributed memory can be cumbersome, requiring multiple all-to-all Message Passing Interface (MPI) messages during each time step.

Instead, we avoid splitting the Hamiltonian and propagate the total Hamiltonian in time using a second order Crank-Nicolson scheme where
%
\begin{equation}
    \psi(\mathbf{r},t+\Delta t) \approx e^{-i\hat{H}\Delta t}\psi(\mathbf{r},t).
    \label{eq:Crank_Nicolson}
\end{equation}
%
We note that the Crank-Nicolson method is not tridiagonal (due to a tensor product) and a direct solution would require $\mathcal{O}(\mathcal{N}^3)$ operations and $\mathcal{O}(\mathcal{N}^2)$ memory which is significantly more than in the split operator method. However, the system of equations in the full Crank-Nicolson method is sparse and iterative methods can be used to vastly accelerate the time propagation. We utilize the Generalized Minimal Residual Method (GMRES), implemented in PETSc, which solves the sparse system of linear equations in $\mathcal{O}(\mathcal{N}\log(\mathcal{N}))$ operations and $\mathcal{O}(\mathcal{N})$ memory. The PETSc library makes it straightforward to parallelize the Crank-Nicolson method on modern supercomputers with distributed memory. On a local supercomputer (Summit, CU Boulder), we achieved super-linear scaling up to 3,000+ cores allowing us to complete simulations in a matter of hours that would take weeks running on a high-end workstation. 
% subsection time_propagation (end)



\subsection{Convergence studies} % (fold)
\label{sub:convergence_studies}
Numerical solutions to the TDSE require a convergence study to ensure the final results are reliable. One does this by varying  a free parameter, such as grid spacing, spherical harmonic expansions, time step, ect, until the observable in question changes within some tolerance. It is possible to use an error calculation and reduce it until a numerical tolerance is met. However, graphical convergence, when 2 lines plotted on top of each other are indistinguishable, is often a more practical convergence criteria. In Table~\ref{tab:grid_spacing} I show the error of the ground state energies of a hydrogen like atom with difference charge ($Z$) converge with grid spacing when using 4th order finite difference.
\begin{table}[t]
\begin{center}
\begin{tabular}{|c|c|c|c|c|c|}
\hline
dx & Z=1 & Z=2 & Z=3 & Z=4 & Z=5 \\ \hline
4.000e-01 & 5.995e-03 & 6.217e-02 & 1.590e-01 & 2.568e-01 & 3.416e-01\\ \hline
2.000e-01 & 3.035e-04 & 5.995e-03 & 2.612e-02 & 6.217e-02 & 1.086e-01\\ \hline
1.000e-01 & 1.041e-05 & 3.035e-04 & 1.841e-03 & 5.995e-03 & 1.392e-02\\ \hline
5.000e-02 & 2.225e-07 & 1.041e-05 & 7.810e-05 & 3.035e-04 & 8.331e-04\\ \hline
2.500e-02 & -2.663e-09 & 2.225e-07 & 2.290e-06 & 1.041e-05 & 3.204e-05\\ \hline
1.250e-02 & -7.101e-10 & -2.672e-09 & 2.992e-08 & 2.225e-07 & 8.341e-07\\ \hline
\end{tabular}
\end{center}
  \caption{\label{tab:grid_spacing}The relative error of the ground state energy for a Hydrogen like atom with an nuclear charge Z. A grid spacing around 0.1 produces well converged results for Z=1. Excited states have lower relavive error.}
\end{table}

% subsection convergence_studies (end)
\subsection{Parallel Computing} % (fold)
\label{sub:parallel_computing}
\begin{figure}[h!]
\centering
\includegraphics[width=0.5\columnwidth]{figs/Rydberg/multi_node.eps}
\caption{\label{fig:scaling} Scaling results for present Crank-Nicolson method. Two runs each for calculations with 1 million (blue with squares) and 15 million grid points (green with triangles) have been performed. Note that the scaling improves with increasing number of grid points.
}
\end{figure}
Many simulations can be preformed on a laptop or small desktop, however, the large calculations, such as those done in Cartesian coordinates or utilizing bi-circular laser polarizations, benefit from supercomputing resources. Since the code is implemented utilizing the PETSc library and through the use of MPI, it is able to take advantage of the distributed memory of a modern supercomputer. Linear scaling, when the computational time is cut in half when twice as many processors are used, is often the benchmark for code scaling. This code obtains super-linear (better than linear) scaling on the summit supercomputer up to 3,000+ processors (see Fig.~\ref{fig:scaling}). This is possible due to the increased size of cache memory as then number of CPUs increases. This allows for calculations that would take a month on a desktop to be completed in a few hours on a supercomputer. Additionally, the supercomputing systems come with a large increase in the available RAM (often on the order of terabytes) greatly reducing the memory limitations on calculation size.

% subsection parallel_computing (end)

% section numerical_methods (end)


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Single active electron potentials}
\label{sec:SAE}
For many atoms, full treatment of Eq.~\ref{eq:atoms_and_molecules} is impractical if not impossible. Many of the lasers utilized in studying ultrafast interactions primarily interact with a single valence electron. In this case, it becomes advantageous to treat only the single active electron in the potential produced by freezing the remaining N-1 electrons in their ground state reducing the problem from $3^N$-dimensions down to 3-dimension. The resulting Hamiltonian becomes
\begin{equation}
  \label{eq:SAE_TDSE}
  \hat{H} = -\frac{\mathbf{p}^2}{2} + V_{SAE}(\mathbf{r}) + V_{las}(t)
\end{equation}
where $V_{las}(t)$ is the laser operator and $V_{SAE}(\mathbf{r})$ is the SAE potential. The SAE potentials utilized take the form
\begin{equation}
  \label{eq:SAE_pot}
  V_{SAE}(\mathbf{r}) = - \frac{z}{r} - \frac{Z_c e^{-c r}}{r} - \sum_n a_n e^{-b_n r}.
\end{equation}
The coefficients are obtained by fitting to a potential obtained through density functional theory (DFT, \textbf{citation}).  Tab.~\ref{tab:SAE} contains the coefficients for SAE potentials utilized in this thesis.
\begin{table}
\begin{center}
 \begin{tabular}{|c | c | c | c | c | c|} 
 \hline
 \textbf{Atom} & $z$ & $Z_c$ & $c$ & $a_1$ & $b_1$ \\
 \hline
 \textbf{H} & 1 & - & - &  - & - \\ 
 \hline
 \textbf{He} & 1 & 1 & 2.0329 &  0.3953 & 6.1805 \\ 
 \hline
 \textbf{Ne} & 1 & 1 & 2.0329 &  0.3953 & 6.1805 \\ 
 \hline
\end{tabular}
\end{center}
 \caption{\textbf{TODO - UPDATE TABLE with correct He and Ne values}}
 \label{tab:SAE}
\end{table}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Two active electron calculations} % (fold)
\label{sec:two_active_electron_time_calculations}
Although SAE potentials have been highly successful at describing atom laser interactions, they break down in the vicinity of autoionizing states and for lasers capable of double ionization of atoms or molecules. In the case of autoionizing states, non-sequential double ionization (NSDI), and shake-up processes, the electron-electron repulsion term plays a critical role. For two-electron systems in length gauge, the TDSE takes the 
\begin{equation}
    \label{eq:tdse_ee}
    \hat{H} = -\frac{\hat{\mathbf{p}}^2_{e_1}}{2} - \frac{\hat{\mathbf{p}}^2_{e_2}}{2}  + \frac{1}{r_{e_1, e_2}} - \sum_{n} \left(\frac{Z_n}{r_{e_1,n}}+\frac{Z_n}{r_{e_2,n}}\right) + \mathbf{E}(t) \cdot (\mathbf{x_{e_1}} + \mathbf{x_{e_2}}).
\end{equation}
A full treatment of Eq.~\ref{eq:tdse_ee} requires a 6D numerical solution. The numerical methods utilized for fully correlated He results is described in detail in Chap.~\ref{cha:electron_correlation}.
% section two_active_electron_time_dependent_schr"odinger_equation (end)


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Laser pulses} % (fold)
\label{sec:laser_pulses}
In order to satisfy maxwell's equations, the electric field of a laser pulse must integrate to zero. It is therefore convienent to sent the vector potential $A(t)$ such that 
\begin{equation}
    A(t) = \frac{c E_0}{\omega_A}f(t) \cos(\omega_A t +\phi_A)
\end{equation}
where $E_0=\sqrt{I}$ is the peak electric field amplitude with $I$ is the peak intensity, $c$ is the speed of light, $\omega_A$ is the central frequency of the vector potential, $\phi_A$ is the carrier-to-envelope phase, and $f(t)$ is the envelope function that starts and ends at zero. We often consider $f(t)$ to be a Gaussian or sine squared function. The electric field can then be obtained via
\begin{equation}
\begin{split}
\label{eq:efield}
E(t) =& -\frac{1}{c}\frac{\partial}{\partial t}A(t)
\\
=&E_0f(t) \sin(\omega_A t +\phi_A)
\\
&
-\frac{E_0}{\omega_A}\frac{\partial f(t)}{\partial t}
\cos(\omega_A t +\phi_A).
\end{split}
\end{equation}
where the second term forces the time integral of the electric field to be zero and is only large when the envelop varies quickly over a single optical cycle. This is the case in few cycle pulses and those that turn on or off quickly.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Frequency shift} % (fold)
\label{sub:frequency_shift}
\begin{figure}[h!]
\centering
   \includegraphics[width=0.35\linewidth]{figs/Frequency_shift/01_field.eps}
   \includegraphics[width=0.35\linewidth]{figs/Frequency_shift/01_spec.eps}
   \includegraphics[width=0.35\linewidth]{figs/Frequency_shift/03_field.eps}
   \includegraphics[width=0.35\linewidth]{figs/Frequency_shift/03_spec.eps}
   
\caption{Temporal (left) and spectral (right) distributions of vector potential (solid lines) and electric field (dashed line) for pulses with FWHM of 1 cycle (top), and 3 cycles (bottom) at central frequency $\omega_A = 1.0$ a.u.\  of the vector potential. Also shown is the Gaussian envelope of the vector potential. 
} 
  \label{fig:spectra}
\end{figure}

As the pulse length decreases, the central frequency (defined by the peak of the frequency spectrum) of the vector potential and electric fields differ. In Fig.~\ref{fig:spectra} the dashed blue lines show the electric field and the orange solid lines show the vector potential for a Gaussian pulse with a pulse duration of 1 cycle FWHM (top) and 4 cycle FWHM (bottom). The time domain (right) looks similar, up to the expected $\pi/2$ phase shift, but the frequency spectrum (right) differ significantly for the 1 cycle FWHM pules. By utilizing TDSE solutions, it is possible to show that the central frequency of the electric field is the relivant frequency in both length and velocity gauge calculations \cite{venzke_central_2018}. It is, therefore, important to correct the central frequency used in the vector potential when the pulse length is short. An approximative correction is given by
\begin{equation}
\label{eq:fshift}
\frac{\omega_E}{\omega_A} 
\approx
\frac{1+\sqrt{1+4(\pi N)^{-2}}}{2}.
\end{equation}
%
Here
%
\begin{equation}
\begin{split}
\label{eq:nbar}
 N \equiv \frac{\omega_A}{\pi} \sqrt{\frac{\int_{-\infty}^{\infty} (t-t_0)^2 f(t) dt}{\int_{-\infty}^{\infty} f(t) dt}}.
\end{split}
\end{equation}
%
is the number of cycles within one standard deviation to either side of the pulse center, with
%
\begin{equation}
\begin{split}
t_0 \equiv \frac{\int_{-\infty}^{\infty} t f(t) dt}{\int_{-\infty}^{\infty} f(t) dt}.
\end{split}
\end{equation}
This correction is sufficient for most pulse shapes, however, correction terms can be found in \cite{venzke_central_2018}.


% Few-cycle laser pulses are used in many interesting strong-field applications (for reviews, see e.g., \cite{popmintchev10,suzuki14,vrakking14,pazourek15,wang15,xu16}): For example, high-order harmonics and (isolated) attosecond pulses are generated, ultrafast atomic and molecular dynamics as well as charge transfer and exciton dynamics can be induced and time resolved, molecular structure can be imaged on ultrashort time scales, or chemical reactions may be controlled. Therefore, light sources generating ultrashort intense laser pulses in different regions of the spectrum, at extreme ultraviolet \cite{goulielmakis08}, ultraviolet \cite{durfee99}, optical \cite{fork87}, near-infrared \cite{zhou94,nisoli96,nisoli97} and infrared wavelengths \cite{ishii14,pupeza15,li16}, have been developed over the past decades.  The simulation of the time-dependent response of matter to a few-cycle pulse, e.g. via the numerical solution of the corresponding time-dependent Schr\"odinger equation (TDSE), can however crucially depend on the definition of the electric field $E(t)$ used. To achieve quantitative agreement between theory and experiment, the potential issues present in both numerical calculations and experiment must be well understood and minimized.

% As pointed out by Chelkowski and Bandrauk \cite{chelkowski02}, the representation of $E(t)$ via an envelope function times a trigonometric function may lead to a non-vanishing potential $A(t)$ at the end of the pulse. This inconsistency can be resolved by first defining the magnitude of the vector potential $A(t)$ as (we use Hartree atomic units: $e = m_e = \hbar =1$) \cite{chelkowski02}: 
% \begin{equation}
% A(t) = \frac{c E_0}{\omega_A}f(t) \cos(\omega_A t +\phi_A),
% \label{eq:vectorpotential}
% \end{equation}
% where $f$, $\omega_A$, $c$, $E_0$ and $\phi_A$ are the envelope function, central frequency, speed of light, peak electric field amplitude, and carrier envelope phase of the vector potential, respectively.
% The prefactors ensure that the peak intensity of the laser field is $I = \tfrac{c}{8\pi}E_0^2$.
% The magnitude of the electric field is then obtained via the derivative:
% \begin{equation}
% \begin{split}
% \label{eq:efield}
% E(t) =& -\frac{1}{c}\frac{\partial}{\partial t}A(t)
% \\
% =&E_0f(t) \sin(\omega_A t +\phi_A)
% \\
% &
% -\frac{E_0}{\omega_A}\frac{\partial f(t)}{\partial t}
% \cos(\omega_A t +\phi_A).
% \end{split}
% \end{equation}

% The expression for the electric field, Eq.~(\ref{eq:efield}), includes a term that depends on the time derivative of $f$ and, hence, may have significant effects in the case of few-cycle pulses. As we will show below, a direct implication is that the central frequency of the electric field spectrum, $\omega_E$, is not equal to $\omega_A$. The frequency shift $|\omega_E - \omega_A|$ is a purely electromagnetic effect that is directly related to the definition of the electric field via the vector potential given in Eq.\ (\ref{eq:efield}). For long pulses, the frequency shift is small, but it increases as pulse duration decreases. Note, that in experiment typically the central laser frequency of the electric field $\omega_E$ is measured and reported, while in numerical calculations it is useful to define the laser pulse via the vector potential and the related central frequency $\omega_A$. It is therefore important to study what impact, if any, the difference between the central frequencies has on numerical calculations, or on the interpretation of theoretical results. 

% By solving the time-dependent Schr\"odinger equation both numerically as well as within perturbation theory,
% we show below that theoretical results obtained for linear processes---such as excitation and ionization---involving few-cycle pulses with the same value for the central frequencies $\omega_A$ and $\omega_E$ do not coincide. Furthermore, we find that the frequency shift is also noticeable for nonlinear processes, such as two-photon excitation and high-order harmonic generation, and it scales with the number of photons involved. Our results also demonstrate that it is the central frequency of the electric field $\omega_E$ that is the physical relevant quantity for the interpretation of laser driven quantum mechanical processes. Therefore, the frequency shift should be taken into account when setting the central frequency $\omega_A$ of the vector potential in a numerical calculation or, more generally, a theoretical analysis.

% The paper is organized as follows: In Section \ref{sec:pulse}, we present an analytical estimate for the magnitude of the frequency shift, and discuss how to correct for it.
% In Section \ref{sec:applications}, we present results of numerical solutions of the time-dependent Schrödinger equation, which illustrate how the frequency shift affects a number of quantum mechanical processes: photoionization, resonant excitation, and high-harmonic generation. We end with a brief summary.


% \begin{figure}[t]
% \centering
   
%    % \includegraphics[width=0.49\linewidth]{figs/01_field.eps}
%    % \includegraphics[width=0.49\linewidth]{figs/01_spec.eps}
%    % \includegraphics[width=0.49\linewidth]{figs/03_field.eps}
%    % \includegraphics[width=0.49\linewidth]{figs/03_spec.eps}
   
% \caption{(Color online)
% Temporal (left) and spectral (right) distributions of vector potential (solid lines) and electric field (dashed line) for pulses with FWHM of 1 cycle (top), and 3 cycles (bottom) at central frequency $\omega_A = 1.0$ a.u.\  of the vector potential. Also shown is the Gaussian envelope of the vector potential. 
% } 
%   \label{fig:spectra}
% \end{figure}

% The frequency shift due to the difference in central frequencies is illustrated in Fig.~\ref{fig:spectra}, where the vector potential $A$ and the electric field $E$, obtained from Eqs. (\ref{eq:vectorpotential}) and (\ref{eq:efield}) for a Gaussian envelope $f(t)$, are compared in both the time and frequency domain. While the temporal behavior is satisfactory, the spectral distributions reveal different central frequencies. We define the central frequency $\omega_A$ ($\omega_E$) as the location of the maximum in the spectral density $|\tilde{A}(\omega)|$ ($|\tilde{E}(\omega)|$). The discrepancy is much greater for the 1-cycle full-width at half-max (FWHM) pulse (top), than for the 3-cycle FWHM pulse (bottom).

% \begin{table}
% \begin{center}
%  \begin{tabular}{||c | c | c | c||} 
%  \hline
%  Name & Envelope Function $f(t)$ & $ N/N_{\text{FWHM}}$ & $\gamma_2$ \\ [0.5ex] 
%  \hline\hline
%  Gaussian & $e^{-(t/T)^2}$ & 0.849 & 0 \\ 
%  \hline
%  Cos$^2$ & $\begin{cases} 
%       \cos^2\left(\frac{t}{T}\right) & -\frac{\pi}{2} \leq \frac{t}{T} \leq \frac{\pi}{2} \\
%       0 & \text{otherwise}
%    \end{cases}$ & 0.723 & -0.594 \\
%  \hline
%   Cos$^4$ &  $\begin{cases} 
%        \cos^4\left(\frac{t}{T}\right) & -\frac{\pi}{2} \leq \frac{t}{T} \leq \frac{\pi}{2} \\
%        0 & \text{otherwise}
%     \end{cases}$ & 0.777 & -0.381 \\
%  \hline
%  Sech & $\text{sech}(\frac{t}{T})$ & 1.19 & 2.00 \\
%  \hline
% \end{tabular}
% \end{center}
%  \caption{Several common analytic pulse envelopes. The conversion factor between $N$, as defined in Eq.~(\ref{eq:nbar}) (number of cycles within one standard deviation to either side of the maximum), and the more typical $N_{\text{FWHM}}$ (number of cycles in the full-width half-maximum of the electric field) is given. The last column shows the excess kurtosis $\gamma_2$, defined in Eq.~(\ref{eq:gamma2}), which is independent of the pulse duration $T$.}
%  \label{tab:envelopes}
% \end{table}

% For the further analysis, we note that in order for the central frequencies to be well-defined and consistent with the definition of $\omega_A$ in Eq. (\ref{eq:vectorpotential}), we make several assumptions about the envelope $f(t)$:
% \begin{itemize}
%   \item $f(t)$ is nonnegative and continuously differentiable,
%   \item $f(t)$ falls off at least exponentially for large $|t|$, 
% \item $f(t)$ contains no appreciable Fourier components larger than $\omega_A$.
% \end{itemize}
% These assumptions could be relaxed significantly, but they are sufficient for the present discussion and all practical purposes. The ratio of the central frequencies is given by the leading terms of an expansion in $1/N$ as (see Appendix \ref{sec:appendix-frequency}):
% \begin{eqnarray}
% \label{eq:fshift}
% \frac{\omega_E}{\omega_A} 
% &=& 
% \frac{1+\sqrt{1+4(\pi N)^{-2}}}{2}+ \frac{\gamma_2}{6\pi^4} N^{-4} + O( N^{-6})
% \\
% \label{eq:fshiftapprox}
% &\approx& 
% \frac{1+\sqrt{1+4(\pi N)^{-2}}}{2}.
% \end{eqnarray}
% %
% Here
% %
% \begin{equation}
% \begin{split}
% \label{eq:nbar}
%  N \equiv \frac{\omega_A}{\pi} \sqrt{\frac{\int_{-\infty}^{\infty} (t-t_0)^2 f(t) dt}{\int_{-\infty}^{\infty} f(t) dt}}.
% \end{split}
% \end{equation}
% %
% is the number of cycles within one standard deviation to either side of the pulse center, with
% %
% \begin{equation}
% \begin{split}
% t_0 \equiv \frac{\int_{-\infty}^{\infty} t f(t) dt}{\int_{-\infty}^{\infty} f(t) dt},
% \end{split}
% \end{equation}
% %
% and lastly $\gamma_2$ is the excess kurtosis of the envelope
% %
% \begin{equation}
% \label{eq:gamma2}
% \gamma_2 \equiv \frac{\left[\int_{-\infty}^{\infty} (t-t_0)^4 f(t) dt\right]\left[\int_{-\infty}^{\infty} f(t) dt\right]}{\left[\int_{-\infty}^{\infty} (t-t_0)^2 f(t) dt\right]^2}-3.
% \end{equation}
% %
% Note that $N$ is proportional to the more typical $N_{\text{FWHM}}$ (number of cycles in the FWHM of $f(t)$), but the ratio $N/N_{FWHM}$ depends on the shape of the envelope (c.f., Table \ref{tab:envelopes}). 

% \begin{figure}[t]
% \centering
%    % \includegraphics[width=0.8\linewidth]{figs/fshift51.eps}
% \caption{(Color online)
% Ratio $\omega_E/\omega_A$ as a function of the normalized number of cycles $ N$ defined in Eq.~(\ref{eq:nbar}). The numerical results were calculated by maximizing $\tilde{E}(\omega)$ for Gaussian (dotted line), $\text{sech}$ (dashed-dotted line), and $\sin^4$ (dashed line) envelopes and are compared with the simple analytic estimate (solid line) given in Eq.~(\ref{eq:fshiftapprox}). The inset reveals a slight dependence on envelope shape, which can be attributed to the correction term in Eq.~(\ref{eq:fshift}).
% }
%   \label{fig:shift}
% \end{figure}

% Eq.~(\ref{eq:fshift}) indicates that the ratio $\omega_E/\omega_A$ depends on the number of cycles and the pulse shape, but it is independent of peak intensity, carrier envelope phase, ellipticity, and $\omega_A$ itself. In fact, the first term of the expansion, Eq.~(\ref{eq:fshiftapprox}), is a very accurate estimate even for single cycle pulses, showing that the shift is nearly independent of pulse shape. This can be seen from the comparison between the predictions based on Eq.~(\ref{eq:fshiftapprox}) with the exact frequency shift for a variety of pulse shapes in Fig.~\ref{fig:shift}. The exact shift was calculated by numerically maximizing the analytic expressions for $|\tilde{E}(\omega)|$. The slight dependence on pulse shape is visible in the inset; the differences are described well by the correction term in Eq.~(\ref{eq:fshift}), which involves the excess kurtosis $\gamma_2$.

% In the next section, we demonstrate that $\omega_E$ is the physically observable and relevant central frequency. Therefore, when modeling the interaction with a pulse using Eqs.~(\ref{eq:vectorpotential}) and (\ref{eq:efield}), one should determine $\omega_A$  such that it corresponds to the correct $\omega_E$. There are two different methods to do this. The first one is to specify $N$, and use Eq.~(\ref{eq:fshiftapprox}) to obtain $\omega_A$. However since $N$ depends implicitly on $\omega_A$ through Eq.~(\ref{eq:nbar}), the envelope $f(t)$ must be stretched in time by the same factor such that $N$ remains unchanged. The second method is to specify $f(t)$ instead of $N$. In that case, substituting Eq.~(\ref{eq:nbar}) into Eq.~(\ref{eq:fshiftapprox}) and solving for $\omega_A$ yields
% %
% \begin{equation}
% \label{eq:alternative}
% \omega_A \approx \omega_E - \frac{\int_{-\infty}^{\infty} f(t) dt}{\omega_E\int_{-\infty}^{\infty} (t-t_0)^2 f(t) dt}.
% \end{equation}
% %
% Greater accuracy could be obtained in either case by including the correction term in Eq. (\ref{eq:fshift}); however, the results in Fig.~\ref{fig:shift} show that this is in general not necessary. 

% In this section we present results of numerical calculations and first-order perturbation theory which exemplify effects of the frequency shift on observables related to excitation, ionization and high harmonic generation induced by short laser pulses. The frequency shifts obtain using first-order perturbation theory and numerical calculations agree well with our analytical predictions shown in Section~\ref{sec:pulse} and derived in Appendix~\ref{sec:appendix-frequency}. To this end, we solved the 3D one-electron time-dependent Schr\"odinger equation (TDSE) in velocity gauge:
% \begin{equation}
% i\frac{\partial}{\partial t}\psi(\mathbf{r},t) = \left[\frac{\mathbf{p}^2}{2} - \frac{\mathbf{A}(t) \cdot \mathbf{p}}{c} + V(\mathbf{r})\right]\psi(\mathbf{r},t)
% \end{equation}
% and length gauge
% \begin{equation}
% i\frac{\partial}{\partial t}\psi(\mathbf{r},t) = \left[\frac{\mathbf{p}^2}{2} + \mathbf{E}(t) \cdot \mathbf{\mathbf{r}} + V(\mathbf{r})\right]\psi(\mathbf{r},t)
% \end{equation}
% for atomic hydrogen with a soft-core Coulomb potential
% \begin{equation}
% V(\mathbf{r}) = -\frac{1}{\sqrt{\mathbf{r}^2+\alpha ^2}}.
% \end{equation}
% We consider a linearly polarized laser pulse within the dipole approximation, so $\mathbf{A}(t)=A(t)\hat{z}$ and $\mathbf{E}(t)=E(t)\hat{z}$. Taking advantage of azimuthal symmetry, the wavefunction can be represented in 2D cylindrical coordinates $\rho$ and $z$. We used the second order finite difference method for spatial derivatives and the fully implicit second order Crank-Nicholson method for time propagation (for more details on the numerical implementation, see \cite{venzke-submitted}). The laser field magnitudes $A(t)$ and $E(t)$ were defined as in Eq.~(\ref{eq:vectorpotential}) and Eq.~(\ref{eq:efield}), with a Gaussian envelope function $f(t)$.
% Specifically,
% \begin{equation}
% \label{eq:numericalVecPot}
% A(t) = \frac{E_0c}{\omega_A}\sin(\omega_A t)e^{-(2t/\tau)^2\ln 2} ~,
% \end{equation}
% where $\tau$ is the FWHM pulse duration. The results presented below were obtained in velocity gauge, but additional test calculations in length gauge have confirmed that the results are gauge invariant.

% In all calculations for single photon ionization (Sec.~\ref{sec:single_photon}), excitation (Sec.~\ref{sec:excitation}) and high harmonic generation (Sec.~\ref{sec:HHG}) we used $\alpha=0.029$ a.u.,\ a grid spacing of 0.1 a.u.,\ and a time step of 0.1 a.u. The soft core parameter is used to match the ground state energy to that of atomic hydrogen, given by $E_{1s} = -0.5001$ a.u. on the grid, and an excited state energy of $E_{2p} = -0.12504$ a.u.\  To ensure the wavefunction remains on the grid for our calculation of the photoelectron spectrum, the grid extended 500 a.u.\  in the $\rho$-direction and 1000 a.u in the $z$-direction, with an exterior complex scaling absorbing boundary in the outer 50 a.u for single photon ionization (Sec.~\ref{sec:single_photon}). The excitation (Sec.~\ref{sec:excitation}) and high harmonic generation (Sec.~\ref{sec:HHG}) calculations were preformed on a grid that extended over 100 a.u.\  in the $\rho$-direction and 200 a.u.\ in the $z$-direction, with an absorbing boundary over the outer 5 a.u.

% First, we consider single photon ionization of the hydrogen atom by a few-cycle laser pulse with peak intensity $10^{13}$ W/cm$^2$ and central frequency $\omega_{\text{central}} = 2.0$ a.u. The central frequency is implemented either by setting $\omega_A=\omega_{\text{central}}$ or setting $\omega_E=\omega_{\text{central}}$, using the method described in the previous section. Photoelectron momentum spectra $P(k)$ were obtained by the following procedure: the TDSE was propagated for five times the FWHM pulse duration plus an additional 100 a.u.\  in time, then all bound states with principle quantum number $n\le 8$ were projected out, and lastly the remaining unbound wavepacket $\psi_{\text{ionized}}$ was projected onto coulomb wave functions up to $l_{\text{max}}=5$. That is,
% %
% \begin{equation}
% P(k) = \sum_{l=0}^{l_{\text{max}}} \left|\int F_{l}(-\tfrac{1}{k}, kr)Y^*_{l0}(\hat{r})\psi_{\text{ionized}}(\vec{r})d^{3}\vec{r}~\right|^2 ~.
% \end{equation}


% \begin{figure}[t]
% \centering
%    % \includegraphics[width=0.8\linewidth]{figs/single_photon_ion.eps}
% \caption{(Color online)
% Photoelectron spectra $P(k)$ as function of photoelectron momentum obtained for interaction of hydrogen atom with laser pulses at central frequencies $\omega_A=2$ (dashed line) and $\omega_E=2$ (solid line) and duration of (a) 10 cycles and (b) 2 cycles FWHM.
% }
%   \label{fig:ionizationA}
% \end{figure}

% The results in Fig.~\ref{fig:ionizationA} show that in fact the photoelectron spectra for central frequency $\omega_A = 2$ a.u.\  (solid lines) and $\omega_E = 2$ a.u.\  (dashed lines) do not agree due to the frequency shift. As expected, the discrepancy is larger for 2 cycle FWHM (panel (b)) than for 10 cycle FWHM (panel (a)) pulses. These results however raise the question whether the central frequency of the vector potential $\omega_A$ or the central frequency of the electric field $\omega_E$ is the relevant quantity for further physical interpretation or a comparison with experimental data. To address this question, we consider the resonant population transfer between bound states by analyzing results of numerical calculation as well as those obtained using first-order perturbation theory in the next subsection.

% Next, we examine transitions to the $n=2$ orbitals in the hydrogen atom as a function of both pulse length and central frequency of the vector potential ($\omega_A$) and the electric field ($\omega_E$).
% Typically, the excitation probability is greatest when the central frequency of the laser matches the resonant frequency for $n_p$ photon absorption, given by
% \begin{equation}
% \omega_{\text{res}} = |E_\text{final} - E_\text{initial}|/n_p,
% \end{equation}
% where $E_\text{final}$ and $E_\text{initial}$ are the energy of the final and initial state, respectively. In view of the predicted frequency shift between the central frequencies $\omega_A$ and $\omega_E$, we therefore expect that the results for resonant excitation will provide insights into the physical relevance of $\omega_A$ vs.~$\omega_E$.

% Within first order perturbation theory, the excitation probability is given by (for further analysis, see Appendix \ref{sec:appendix-perturbation}):
% \begin{equation}
% \begin{split}
% P_{i\rightarrow f}&= |\tilde{A}(\omega_\text{res})|^2\left(\frac{\mu\omega_\text{res}}{c}\right)^2 \\
% &=\frac{\pi}{\ln{2}}\left(\frac{\mu E_0\omega_\text{res}\tau}{4\omega_A}\right)^2
% \Big[e^{-(\omega_A-\omega_\text{res})^2\tau^2/(16\ln{2})}\\
% &\qquad -
% e^{-(\omega_A+\omega_\text{res})^2\tau^2/(16\ln{2})}
% \Big]^2,
% \end{split}
% \label{perturbation}
% \end{equation}
% Here we have used the pulse defined in Eq.~(\ref{eq:numericalVecPot}) and $\mu=2^{7.5}3^{-5}$ is the transition dipole for the hydrogen $1s\rightarrow 2p$ transition. Eq.~(\ref{perturbation}) shows that the excitation probability $P_{i\rightarrow f}$ is not maximized at  $\omega_A=\omega_\text{res}$, due to the prefactor of $\omega_A^{-2}$. This prefactor originates from Eq. (\ref{eq:vectorpotential}), where it ensures that the peak intensity is held fixed as $\omega_A$ changes.

% \begin{figure}[t]
% \centering
%    % \includegraphics[width=\linewidth]{figs/2p_population_comb.eps}
% \caption{(Color online)
% Population in $2p$ state following one-photon excitation of hydrogen atom with a laser pulse as a function of $\omega_A$ (left) and $\omega_E$ (right) for different pulse lengths at peak intensity $10^{12}$ W/cm$^2$. Each line represents results obtained for a fixed pulse duration in terms of $\tau_1=405$ as. The results from time-dependent Schr\"odinger equation (TDSE) calculations (a,b) and predictions within first-order perturbation theory (PT) (c,d) are in excellent agreement. The vertical line marks the energy difference between $2p$ and initial $1s$ state. The green dots indicate the maximum excited state population for each pulse duration. 
% }
%   \label{fig:h-excited_2p}
% \end{figure}

% We have also obtained the population in the $2p$ state due to single photon excitation by direct numerical solution of the TDSE. These numerical results are presented together with those obtained within first order perturbation theory, Eq.~(\ref{perturbation}), in Fig.~\ref{fig:h-excited_2p} as function of $\omega_A$ (left column) and $\omega_E$ (right column) for various pulse lengths. The pulse length $\tau$ is measured in multiples of the period associated with the resonant frequency
% \begin{equation}
% \tau_{n_p} = \frac{2\pi}{\omega_{res}} = \frac{2\pi n_p}{|E_\text{final}-E_\text{initial}|},
% \end{equation}
% such that $\tau_1\approx 405$ attoseconds, $\tau_2 \approx 811$ attoseconds and so on for the $1s \rightarrow 2p$ transition. For long pulses the peak in the population (marked by a green dot) occurs at the expected frequency $\omega_\text{res}$ (marked by vertical line) for a resonant transition in all distributions. When the pulse length is decreased, the peak in the distributions as a function of $\omega_E$ (right column) remains at $\omega_\text{res}$. In contrast, the peak shifts significantly towards lower frequencies in the distributions as a function of $\omega_A$ (left column) due to the frequency shift. We note that the results of our numerical calculations (upper row) are in excellent agreement with those obtained using first-order perturbation theory (lower row) and indeed both reveal the same dependence on the central frequencies $\omega_A$ and $\omega_E$. Thus, the differences in the distributions as functions of $\omega_A$ and $\omega_E$ are not a numerical artifact but are due to the frequency shift. Furthermore, the observed shift agrees with our estimate obtained in the previous section. Thus, we can conclude that the central frequency of the electric field is the physically relevant quantity for interpreting laser induced excitation processes.


% \begin{figure}[t]
% \centering
%       % \includegraphics[width=\linewidth]{figs/2s_population_comb.eps}
% \caption{(Color online)
% Numerical results for population in $2s$ state following 2-photon excitation with $\tau_2=811$ as. The vertical line marks half of the energy gap between $1s$ and $2s$ representing the resonance condition for the two photon process. Other parameters are the same as in Fig. \ref{fig:h-excited_2p}.
% }
%   \label{fig:h-excited_2s}
% \end{figure}

% These conclusions are further supported by our numerical results for two-photon excitation from the $1s$ to the $2s$ state in Fig.~\ref{fig:h-excited_2s}. Whereas the peak of the population as a function of $\omega_E$ (panel b) occurs at $\omega_\text{res}$, independent of the pulse duration, the peak of the population as a function of  $\omega_A$ once again shifts to lower frequencies in Fig.~\ref{fig:h-excited_2s}(a). We note that, if the population as function of $\omega_A$ in Figs.~\ref{fig:h-excited_2p} and \ref{fig:h-excited_2s} were used to determine the energy difference $|E_\text{final} - E_\text{initial}|$, the error caused by the frequency shift would be twice as much in the two-photon case as in the one-photon case, accounting for the difference in $\tau_{n_p}$. This indicates that multiphoton processes may be affected by the frequency shift even more than few-photon processes. To further illustrate this point, we examine high harmonic generation in subsection~\ref{sec:HHG}.


% Finally, we consider a highly nonlinear laser induced process. High harmonic generation (HHG) in atoms can be described as absorption of an odd number of photons leading to the excitation of a electron, followed by the emission of a single photon as the electron recombines into the ground state. Based on the results above, we expect that in this nonlinear process the frequency shift $\Delta\omega$ between $\omega_A$ and $\omega_E$ will lead to a shift of the energy of the $n_p$th harmonic by $n_p\Delta\omega$. In our calculations the HHG spectrum has been obtained by a Fourier transformation of the time dependent dipole acceleration along the laser polarization direction. A Hanning filter was used to return the dipole acceleration to zero at the beginning and end of the simulation. 

% \begin{figure*}[t]
% \centering
%    % \includegraphics[width=\linewidth]{figs/HHG_w_A.eps}       
%    % \includegraphics[width=\linewidth]{figs/HHG_w_E.eps}
% \caption{(Color online)
% HHG spectrum at driver wavelength 730 nm ($\omega_\text{central}$ = 0.0625 a.u.) vs.\ number of cycles $N_\text{FWHM}$. In the upper plot the central frequency $\omega_A = \omega_\text{central}$ while in the lower panel $\omega_E = \omega_\text{central}$. The vertical white dashed lines mark field-free transition energies between excited states and the ground state, while the green solid lines mark the harmonic energies $n_p\omega_E$ with respect to the central frequency of the electric field.
% }
%   \label{fig:HHG}
% \end{figure*}

% Fig.~\ref{fig:HHG} shows the various harmonics in a HHG spectrum as a function of the number of cycles in the driving laser pulse at a peak intensity of $1\times 10^{14}$ W/cm$^2$ and central frequencies $\omega_A=0.0625$ a.u.\ \ (upper panel) and $\omega_E=0.0625$ a.u.\ \ (lower panel), corresponding to a wavelength of 730 nm. The spectrum consists of odd harmonics and additional emission lines due to the population of excited states during the interaction with the laser pulse. While we will focus on the generation of harmonics, we note that the emission lines occur at photon energies between the 5th and 9th harmonics. The corresponding field-free energy differences between the excited states and the ground state in our numerical model of the hydrogen atom are marked, as reference, by white vertical dashed lines.

% In the spectrum as function of multiples of $\omega_A$ (panel a) one can see that the centers of the harmonics do shift to energies larger than $n_p\omega_A$, as the pulse duration decreases. In fact, the energies of the harmonics follow the analytical predictions for $n_p\omega_E$ (green solid lines). As expected, the shift is as larger as larger the harmonic number. In contrast, in the HHG spectrum obtained as multiples of $\omega_E$ (panel b) the centers of the harmonics remain at the same energy, i.e.~$n_p\omega_E$ (green solid lines), as the pulse duration decreases. This confirms the importance of the shift between the central frequencies of the vector potential and the electric field in nonlinear processes driven by ultrashort pulses. Furthermore, the HHG results confirm that the central frequency of the electric field $\omega_E$ is the physical relevant quantity for the interpretation of light induced processes. Consequently, if in a numerical simulation or theoretical analysis the vector potential is set via Eq.~(\ref{eq:vectorpotential}) it is necessary to consider the frequency shift between $\omega_A$ and $\omega_E$ to avoid a misinterpretation of the results. Our analytical estimates of the frequency shift in Eq.~(\ref{eq:fshiftapprox}) and Eq.~(\ref{eq:alternative}) provide formulas to obtain $\omega_A$ from the physically relevant $\omega_E$.


% We have shown that the definition of the electric field of a laser pulse via the derivative of the vector potential, which guarantees that both quantities vanish at the beginning and end of the pulse, implies that the central frequencies of the spectral distributions of the vector potential and electric field do not coincide. 

% In our analysis we have derived an analytical estimate of the frequency shift, which shows that the shift mainly depends on the number of cycles in the pulse and becomes most relevant for few-cycle pulses. Utilizing results of numerical simulations and first-order perturbation theory we have analyzed how the frequency shift affects excitation, ionization and high harmonic generation induced by short laser pulses. The effect is found to be most noticeable in nonlinear strong-field processes since the frequency shift scales with the number of photons involved. Both, numerical results and predictions based on first-order perturbation theory agree well with each other and confirm that the central frequency of the electric field is the physically relevant quantity for the interpretation of the light induced processes. Thus, the shift should be taken into account when setting the central frequency of the vector potential in numerical simulations to avoid potential misinterpretation of the theoretical results, specifically when compared to experimental data. Eq.~(\ref{eq:fshiftapprox}) and Eq.~(\ref{eq:alternative}) provide formulas to obtain $\omega_A$ from the physically relevant $\omega_E$.

% section laser_pulses (end)

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Observables} % (fold)
\label{sec:observables}

As the wavefunction is not experimentally observable, it is useful to extract experimentally relevant information. For a given observable $\hat{O}$, the expectation value is obtained by calculating $\bra{\Psi}\hat{O}\ket{\Psi}$.


The dipole acceleration operator using the Ehrenfest theorem
\begin{equation}
  \hat{a}_j =  \frac{\partial V(\mathbf{r})}{\partial j}
\end{equation}
where $j \in x, y, z$ are the Cartesian coordinates. For the hydrogen atom, $\hat{a}_j=j/r^3$ where r is the distance from the nucleus.

Bound state populations are obtained using 
\begin{equation}
  P_{\phi_i} = \left|\bra{\phi_i}\ket{\Psi}\right|^2
\end{equation}
where $\phi_i$ is the field free bound state and $\Psi$ is the wavefunction

At the beginning of each simulation, the wavefunction is normalized to 1 such that
\begin{equation}
\bra{\Psi(t_0)}\ket{\Psi(t_0)} = 1
\end{equation}

Ionization is calculated in two manners. First is by time propagating after the pulse and allowing the ionized wave function to be absorbed by the ECS. Ionization is the obtained by taking 
\begin{equation}
  P_{ion}=1-|\bra{\Psi}\ket{\Psi}|^2
\end{equation}
assuming $\bra{\Psi(t_0)}\ket{\Psi(t_0)}=1$. This method is slow to converge and susceptible to numerical roundoff error due to extended time propagation. The preferred method for calculating ionization is 
\begin{equation}
  P_{ion}=1-\sum\limits_i\left|\bra{\phi_i}\ket{\Psi}\right|^2
\end{equation}
where $\phi_i$ is a bound state and the sum over $i$ includes all states the grid supports with a real part of the energy that is less than zero. Therefore the ionization probability can be taken at the end of the pulse reducing the computational expense while reducing numerical error.


The photoelectron spectrum can then be obtained at the end of the pulse by 
\begin{equation}
    P(k,\theta,\phi) \propto \left|\sum_{l,m} Y_{l,m}(\theta,\phi)\int  e^{-i\delta_{kl}}(i)^l \phi_{kl}(r)^* \psi(r,t) dr \right|^2
\end{equation}
where $\phi_{kl}(r)$ is a continuum wave, $\delta_{kl}$ is a phase shift, and $Y_{l,m}(\theta,\phi)$ is a spherical harmonic. See Sec~\ref{sub:continuum_states} for details on obtaining $\phi_{kl}(r)$ and $\delta_{kl}$.
% subsubsection photo_electron_distributions (end)

% subsection observables (end)

